/*************************************************************************//**
 * @file    drv_POW.h
 * @mcu		STM32F1x
 * @brief   Power management
 * @date    08.06.2010
 * @author  Raúl M.
 ****************************************************************************/

/****************************************************************************************************//**
 *                        REQUIRED LIBRARIES
 ********************************************************************************************************/
#include "drv_POW.h"



/****************************************************************************************************//**
 *                        	REQUIRED INTERFACES
 ********************************************************************************************************/

 
/****************************************************************************************************//**
 *                        PRIVATE MEMBERS
 ********************************************************************************************************/




/********************************************************************************************************
 ********************************************************************************************************
 ********************************************************************************************************
 										IMPLEMENTATION	
 ********************************************************************************************************
 ********************************************************************************************************
 ********************************************************************************************************/

/****************************************************************************************************//**
 * @fun		drv_POW_EnterStopMode...
 * @brief	Forces a low power state 
 * @return	n/a
 **********************************************************************************/
void drv_POW_EnterStopMode(void){
	PWR_EnterSTOPMode(PWR_Regulator_LowPower, PWR_STOPEntry_WFE);
}

/****************************************************************************************************//**
 * @fun		drv_POW_ResartClocks...
 * @brief	Resart sysclocks after a STOP mode wakeup 
 * @return	n/a
 **********************************************************************************/
void drv_POW_ResartClocks(void){
	ErrorStatus HSEStartUpStatus;

   /* Enable HSE */
   RCC_HSEConfig(RCC_HSE_ON);
 
   /* Wait till HSE is ready */
   HSEStartUpStatus = RCC_WaitForHSEStartUp();
 
   if(HSEStartUpStatus == SUCCESS)
   {
 
 #ifdef STM32F10X_CL
     /* Enable PLL2 */ 
     RCC_PLL2Cmd(ENABLE);
 
     /* Wait till PLL2 is ready */
     while(RCC_GetFlagStatus(RCC_FLAG_PLL2RDY) == RESET)
     {
     }
 #endif
 
     /* Enable PLL */ 
     RCC_PLLCmd(ENABLE);
 
     /* Wait till PLL is ready */
     while(RCC_GetFlagStatus(RCC_FLAG_PLLRDY) == RESET)
     {
     }
 
     /* Select PLL as system clock source */
     RCC_SYSCLKConfig(RCC_SYSCLKSource_PLLCLK);
 
     /* Wait till PLL is used as system clock source */
     while(RCC_GetSYSCLKSource() != 0x08)
     {
     }
   }
}


